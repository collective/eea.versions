<html xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone">
  <body>

    <div metal:define-macro="versions"
         tal:define="versions nocall:versions | nocall:here/@@getVersions;
                     has_versions has_versions | here/@@hasVersions;
                     anon portal/portal_membership/isAnonymousUser">

      <!-- Information about new versions -->
      <tal:new metal:define-slot="new" tal:define="newest python:versions.newest();">
        <div class="portalMessage warningMessage"
             tal:condition="python:has_versions and newest">
          <tal:messages define="title_state python:newest[0]['title_state']">
            <strong tal:condition="anon" i18n:translate="new_version_available">
              Note: new version is available!
            </strong>
            <strong tal:condition="not:anon">
              <span i18n:translate="">Note: there is a new version available with state:</span> <span tal:replace="title_state" />
            </strong>
          </tal:messages>
          <ul>
            <li tal:repeat="doc python:newest[:1]">
              <a tal:define="doc_url doc/url;
                             doc_published doc/date;
                             doc_title doc/title;
                             doc_title python:doc_published and '%s - %s' % (toLocalizedTime(doc_published), doc_title) or doc_title;"
                 tal:attributes="href doc_url" tal:content="doc_title" />
            </li>
          </ul>
        </div>
        <div class="portalMessage informationMessage"
             tal:define="oldest python:versions.oldest()"
             tal:condition="python:has_versions and (not newest) and oldest">
          <tal:messages define="wftool python:here.portal_workflow">
            <span i18n:translate="" tal:condition="anon">This is the latest published version. </span>

            <tal:non-anonymous tal:condition="not:anon">
              <span i18n:translate="">This is the latest version with state: </span>
              <span tal:define="review_state python:wftool.getInfoFor(context, 'review_state', '(Unknown)');
                                title_state python:wftool.getWorkflowsFor(context)[0].states[review_state].title"
                    tal:content="title_state" />
              <br />
            </tal:non-anonymous>
          </tal:messages>
          <a href="#previous-versions" i18n:translate=""
             tal:condition="python:has_versions and oldest">See older versions.</a>
        </div>
      </tal:new>

      <!-- Information about old versions -->
      <tal:old metal:define-slot="old" tal:define="versions python:versions.oldest()">
        <dl class="portlet portlet-rss publicationPortlet" id="previous-versions"
            tal:condition="python:has_versions and versions">
          <dt class="portletHeader" i18n:translate="report_older_versions">
            Older versions
          </dt>
          <dt class="portletItem" tal:repeat="doc versions">
            <a tal:define="doc_url doc/url;
                           doc_published doc/date;
                           doc_title doc/title;
                           doc_state doc/review_state;
                           doc_title python:doc_published and '%s - %s' % (toLocalizedTime(doc_published), doc_title) or doc_title;"
              tal:attributes="href doc_url;
                              class string:state-$doc_state"
              tal:content="doc_title" />
          </dt>
        </dl>
      </tal:old>

    </div>

  </body>
</html>
